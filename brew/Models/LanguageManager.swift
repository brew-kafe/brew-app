//
//  LanguageManager.swift
//  brew
//
//  Created by Humberto Canedo Cebreros on 10/09/25.
//  Sistema de gesti√≥n de idiomas para la app
//
//

import Foundation
import SwiftUI

// Enum de Idiomas Disponibles
enum AppLanguage: String, CaseIterable {
    case spanish = "es"
    case english = "en"
    case nahuatl = "nah"
    case maya = "may"
    case german = "de"
    case japanese = "ja"
    case catalan = "ca"
    case french = "fr"
    case tsotsil = "tzo"
    
    var displayName: String {
        switch self {
        case .spanish: return "Espa√±ol"
        case .english: return "English"
        case .nahuatl: return "N√°huatl"
        case .maya: return "Maya Yucateco"
        case .german: return "Deutsch"
        case .japanese: return "Êó•Êú¨Ë™û"
        case .catalan: return "Catal√†"
        case .french: return "Fran√ßais"
        case .tsotsil: return "Tsotsil"
        }
    }
    
    var icon: String {
        switch self {
        case .spanish: return "üá≤üáΩ"
        case .english: return "üá∫üá∏"
        case .nahuatl: return "üèõÔ∏è"
        case .maya: return "üóø"
        case .german: return "üá©üá™"
        case .japanese: return "üáØüáµ"
        case .catalan: return "üè¥"
        case .french: return "üá´üá∑"
        case .tsotsil: return "üåΩ"
        }
    }
}

//  Gestor Principal de Idiomas
class LanguageManager: ObservableObject {
    static let shared = LanguageManager()
    
    @Published var currentLanguage: AppLanguage {
        didSet {
            UserDefaults.standard.set(currentLanguage.rawValue, forKey: "selectedLanguage")
            objectWillChange.send()
        }
    }
    
    private init() {
        let savedLanguage = UserDefaults.standard.string(forKey: "selectedLanguage") ?? "es"
        self.currentLanguage = AppLanguage(rawValue: savedLanguage) ?? .spanish
    }
    
    func localizedString(_ key: String) -> String {
        return LocalizationService.shared.getString(for: key, language: currentLanguage)
    }
}

//  Servicio de Localizaci√≥n
class LocalizationService {
    static let shared = LocalizationService()
    
    private let translations: [String: [AppLanguage: String]] = [
        // Settings Section
        "settings": [
            .spanish: "Configuraci√≥n",
            .english: "Settings",
            .nahuatl: "Tlayecanaliztli",
            .maya: "Nu'ukbesajil",
            .german: "Einstellungen",
            .japanese: "Ë®≠ÂÆö",
            .catalan: "Configuraci√≥",
            .french: "Param√®tres",
            .tsotsil: "Smelolal"
        ],
        
        // Profile Section
        "profile": [
            .spanish: "Perfil",
            .english: "Profile",
            .nahuatl: "Motlacayo",
            .maya: "A w√≠inikil",
            .german: "Profil",
            .japanese: "„Éó„É≠„Éï„Ç£„Éº„É´",
            .catalan: "Perfil",
            .french: "Profil",
            .tsotsil: "Sbijilal"
        ],
        "edit_profile": [
            .spanish: "Editar Perfil",
            .english: "Edit Profile",
            .nahuatl: "Ticpatlas Motlacayo",
            .maya: "K'√©exik a w√≠inikil",
            .german: "Profil bearbeiten",
            .japanese: "„Éó„É≠„Éï„Ç£„Éº„É´Á∑®ÈõÜ",
            .catalan: "Editar Perfil",
            .french: "Modifier le profil",
            .tsotsil: "Jelel sbijilal"
        ],
        
        // Notifications Section
        "notifications": [
            .spanish: "Notificaciones",
            .english: "Notifications",
            .nahuatl: "Tetlanonotzalizmeh",
            .maya: "A'almajt'aano'ob",
            .german: "Benachrichtigungen",
            .japanese: "ÈÄöÁü•",
            .catalan: "Notificacions",
            .french: "Notifications",
            .tsotsil: "Sk'elel k'op"
        ],
        "alerts": [
            .spanish: "Alertas",
            .english: "Alerts",
            .nahuatl: "Tenahuatiliztli",
            .maya: "K'a'ajsajil",
            .german: "Warnungen",
            .japanese: "„Ç¢„É©„Éº„Éà",
            .catalan: "Alertes",
            .french: "Alertes",
            .tsotsil: "K'asesel"
        ],
        
        // Preferences Section
        "preferences": [
            .spanish: "Preferencias",
            .english: "Preferences",
            .nahuatl: "Tlen Ticnequi",
            .maya: "Ba'ax ka w√≥ojel",
            .german: "Einstellungen",
            .japanese: "Áí∞Â¢ÉË®≠ÂÆö",
            .catalan: "Prefer√®ncies",
            .french: "Pr√©f√©rences",
            .tsotsil: "K'an chalel"
        ],
        "language_region": [
            .spanish: "Idioma y Regi√≥n",
            .english: "Language & Region",
            .nahuatl: "Totlahtol ihuan Tochan",
            .maya: "T'aan y√©etel lu'um",
            .german: "Sprache & Region",
            .japanese: "Ë®ÄË™û„Å®Âú∞Âüü",
            .catalan: "Idioma i regi√≥",
            .french: "Langue et r√©gion",
            .tsotsil: "K'op xchi'uk lum"
        ],
        "theme": [
            .spanish: "Tema",
            .english: "Theme",
            .nahuatl: "Quenin Neci",
            .maya: "Bix u yila'al",
            .german: "Design",
            .japanese: "„ÉÜ„Éº„Éû",
            .catalan: "Tema",
            .french: "Th√®me",
            .tsotsil: "Stalel"
        ],
        "feedback_support": [
            .spanish: "Comentarios y Soporte",
            .english: "Feedback & Support",
            .nahuatl: "Motlahtol ihuan Tepalehuiliztli",
            .maya: "A t'aan y√©etel √°antaj",
            .german: "Feedback & Support",
            .japanese: "„Éï„Ç£„Éº„Éâ„Éê„ÉÉ„ÇØ„Å®„Çµ„Éù„Éº„Éà",
            .catalan: "Comentaris i suport",
            .french: "Commentaires et support",
            .tsotsil: "K'op xchi'uk koltayel"
        ],
        "faq": [
            .spanish: "Preguntas Frecuentes",
            .english: "FAQ",
            .nahuatl: "Tlamantli Motlatlanilia",
            .maya: "K'√°at chi'ob suukilo'ob",
            .german: "H√§ufige Fragen",
            .japanese: "„Çà„Åè„ÅÇ„ÇãË≥™Âïè",
            .catalan: "Preguntes freq√ºents",
            .french: "FAQ",
            .tsotsil: "Jajch' k'ucha'al"
        ],
        
        // General Section
        "general": [
            .spanish: "General",
            .english: "General",
            .nahuatl: "Nochi",
            .maya: "Tul√°akal",
            .german: "Allgemein",
            .japanese: "‰∏ÄËà¨",
            .catalan: "General",
            .french: "G√©n√©ral",
            .tsotsil: "Skotol"
        ],
        "about_brew": [
            .spanish: "Acerca de Brew",
            .english: "About Brew",
            .nahuatl: "Ipan Brew",
            .maya: "Yo'osal Brew",
            .german: "√úber Brew",
            .japanese: "Brew„Å´„Å§„ÅÑ„Å¶",
            .catalan: "Sobre Brew",
            .french: "√Ä propos de Brew",
            .tsotsil: "Yu'un Brew"
        ],
        "log_out": [
            .spanish: "Cerrar Sesi√≥n",
            .english: "Log Out",
            .nahuatl: "Tiquizaz",
            .maya: "J√≥ok'ol",
            .german: "Abmelden",
            .japanese: "„É≠„Ç∞„Ç¢„Ç¶„Éà",
            .catalan: "Tancar sessi√≥",
            .french: "D√©connexion",
            .tsotsil: "Lok'el"
        ],
        
        // Language Selection
        "select_language": [
            .spanish: "Seleccionar Idioma",
            .english: "Select Language",
            .nahuatl: "Xicpehpena Totlahtol",
            .maya: "X√©et' t'aan",
            .german: "Sprache w√§hlen",
            .japanese: "Ë®ÄË™û„ÇíÈÅ∏Êäû",
            .catalan: "Seleccionar idioma",
            .french: "S√©lectionner la langue",
            .tsotsil: "Cha' k'op"
        ],
        "save": [
            .spanish: "Guardar",
            .english: "Save",
            .nahuatl: "Ticpiyaz",
            .maya: "T√°akbesa'al",
            .german: "Speichern",
            .japanese: "‰øùÂ≠ò",
            .catalan: "Desar",
            .french: "Enregistrer",
            .tsotsil: "Maliyel"
        ],
        "cancel": [
            .spanish: "Cancelar",
            .english: "Cancel",
            .nahuatl: "Ticpoloz",
            .maya: "P'atik",
            .german: "Abbrechen",
            .japanese: "„Ç≠„É£„É≥„Çª„É´",
            .catalan: "Cancel¬∑lar",
            .french: "Annuler",
            .tsotsil: "Makal"
        ],
        "current_language": [
            .spanish: "Idioma actual",
            .english: "Current language",
            .nahuatl: "Axcan totlahtol",
            .maya: "Bejla'e' t'aan",
            .german: "Aktuelle Sprache",
            .japanese: "ÁèæÂú®„ÅÆË®ÄË™û",
            .catalan: "Idioma actual",
            .french: "Langue actuelle",
            .tsotsil: "Ora li' k'op"
        ],
        
        // Additional common strings for expansion
        "welcome": [
            .spanish: "Bienvenido",
            .english: "Welcome",
            .nahuatl: "Ximopanolti",
            .maya: "Uts a w√≥otel",
            .german: "Willkommen",
            .japanese: "„Çà„ÅÜ„Åì„Åù",
            .catalan: "Benvingut",
            .french: "Bienvenue",
            .tsotsil: "Lek oy a talelal"
        ],
        "home": [
            .spanish: "Inicio",
            .english: "Home",
            .nahuatl: "Tochan",
            .maya: "Najil",
            .german: "Start",
            .japanese: "„Éõ„Éº„É†",
            .catalan: "Inici",
            .french: "Accueil",
            .tsotsil: "Na"
        ],
        "search": [
            .spanish: "Buscar",
            .english: "Search",
            .nahuatl: "Tictemoz",
            .maya: "Kaxtik",
            .german: "Suchen",
            .japanese: "Ê§úÁ¥¢",
            .catalan: "Cercar",
            .french: "Rechercher",
            .tsotsil: "Sa'el"
        ],
        "yes": [
            .spanish: "S√≠",
            .english: "Yes",
            .nahuatl: "Quema",
            .maya: "Je'el",
            .german: "Ja",
            .japanese: "„ÅØ„ÅÑ",
            .catalan: "S√≠",
            .french: "Oui",
            .tsotsil: "Ja'"
        ],
        "no": [
            .spanish: "No",
            .english: "No",
            .nahuatl: "Amo",
            .maya: "Ma'",
            .german: "Nein",
            .japanese: "„ÅÑ„ÅÑ„Åà",
            .catalan: "No",
            .french: "Non",
            .tsotsil: "Mu"
        ]
    ]
    
    func getString(for key: String, language: AppLanguage) -> String {
        return translations[key]?[language] ?? key
    }
    
    // Method to get all keys for documentation
    func getAllTranslationKeys() -> [String] {
        return Array(translations.keys).sorted()
    }
    
    // Method to check if a key has all language translations
    func isKeyFullyTranslated(_ key: String) -> Bool {
        guard let keyTranslations = translations[key] else { return false }
        return keyTranslations.count == AppLanguage.allCases.count
    }
}
